<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.webproject.essuyo.dao.CompanyDao">
	<select id="listAll" resultType="CompanyVO">
<![CDATA[
select *
from company
order by id
limit #{start},#{limit};
]]>
	</select>

	<select id="select" resultType="CompanyVO">
<![CDATA[
SELECT id, name, type, score, discription, address, number, url, state, time, 
total_visit AS totalVisit, today_visit AS todayVisit, area_list_id AS areaListId 
FROM company WHERE id = #{companyId};
]]>
	</select>

	<select id="11" resultType="CompanyVO">
		select *
		from company where
		<trim prefix="WHERE" suffixOverrides=",">
			<if test="test1 != null"> type = #{test1}</if>
		</trim>
	</select>

	<!-- 리뷰수 -->
	<select id="reviews" resultType="Integer">
		select count(*)
		from
		comment
		where
		company_id=#{companyId};
	</select>

<!-- 	가게평점구하기 -->
<update id="score" parameterType="CompanyVO">
update company 
set score = (select round(AVG(score),1) from comment where company_id=#{companyId}) 
where id=#{id};
</update>

</mapper>










