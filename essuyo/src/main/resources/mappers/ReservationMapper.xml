<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="mappers.Reservation">


<insert id="insert" parameterType="ReservationVO">
INSERT INTO reservation
(state, total_price, res_date, product_count, reg_date, company_id, product_id, user_id) 
VALUES(#{state}, #{totalPrice}, #{resDate}, #{productCount}, NOW(),#{companyId},#{productId},#{userId});
</insert>

<select id="selectLimitById" resultType="ReservationVO">
SELECT id, state, total_price AS totalPrice , res_date AS resDate, product_count AS productCount,
reg_date AS regDate, company_id AS companyId, product_id AS productId, user_id AS userId
FROM reservation WHERE 
		<choose>
   			 <when test="type != null and type.equals('user')">
					user_id = #{id}
   			 </when>
    		 <when test="type != null and type.equals('company')">
					company_id = #{id}
    		</when>
 		</choose>
 		
 		ORDER BY id DESC
 		
 		<if test="start != null and limit != null and limit > 0">
  			limit #{start}, #{limit}
  		</if>
 </select>
 
 <select id="selectNotStateById" resultType="ReservationVO">
SELECT id, state, total_price AS totalPrice , res_date AS resDate, product_count AS productCount,
reg_date AS regDate, company_id AS companyId, product_id AS productId, user_id AS userId
FROM reservation WHERE 
		<choose>
   			 <when test="type != null and type.equals('user')">
					user_id = #{id}
   			 </when>
    		 <when test="type != null and type.equals('company')">
					company_id = #{id}
    		</when>
 		</choose>
 			AND NOT state="취소"
 </select>
 
 <select id="selectTotalPrice" resultType="Integer">
SELECT SUM(total_price) FROM reservation WHERE 
		<choose>
   			 <when test="type != null and type.equals('user')">
					user_id = #{id}
   			 </when>
    		 <when test="type != null and type.equals('company')">
					company_id = #{id}
    		</when>
 		</choose>
 		AND NOT state="취소"
 		
 </select>


</mapper>